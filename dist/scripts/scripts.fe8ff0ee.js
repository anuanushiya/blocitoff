"use strict";angular.module("bloc1App",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch"]).config(["$routeProvider","$httpProvider",function(a,b){a.when("/",{templateUrl:"views/AuthView.html",controller:"AuthCtrl"}).when("/tasks",{templateUrl:"views/tasks.html",controller:"TasksCtrl"}).otherwise({redirectTo:"/"});var c=["$rootScope","$q",function(a,b,c){function d(a){return a}function e(a){var d=a.status;return 401===d?(c.path="/",void window.alert("Wrong username and/or password.")):b.reject(a)}return function(a){return a.then(d,e)}}];b.responseInterceptors.push(c)}]).run(["$rootScope","$location","AuthenticationService",function(a,b,c){a.$on("$routeChangeStart",function(a,d){"/"===d.$$route.redirectTo||c.isAuthorized()||(a.preventDefault(),b.url("/"))})}]),angular.module("bloc1App").controller("AuthCtrl",["$scope","$http","$location","AuthenticationService",function(a,b,c,d){this.AuthenticationService=d;var e=this;a.register=function(b,d,f){e.AuthenticationService.register(b,d,f).then(function(){c.url("/"),a.message="Registered!  Sign in above"})},a.login=function(a,b){e.AuthenticationService.login(a,b).then(function(){c.url("/tasks")})}}]),angular.module("bloc1App").factory("AuthenticationService",["$http",function(a){var b={},c=!1;return b.isAuthorized=function(){return c},b.login=function(b,d){var e;return e=a.post("/login",{username:b,password:d}),e.then(function(){c=!0}),e},b.register=function(b,d,e){var f;return f=a.post("/users",{username:b,email:d,password:e}),f.then(function(){c=!0}),f},b.logout=function(){var b;return b=a.post("/logout"),b.then(function(){c=!1},function(){c=!1}),b},b}]),angular.module("bloc1App").factory("DayLeftService",[function(){var a={};return a.convertDay=function(a){return a.forEach(function(a){for(var b,c=new Date(a.date).getTime(),d=Date.now()-c,e=0;8>e;e++)if(864e5*e>d){b=8-e;break}a.date=b}),a},a}]),angular.module("bloc1App").controller("TasksCtrl",["$http","$scope","$location","$timeout","AuthenticationService","DayLeftService",function(a,b,c,d,e,f){this.AuthenticationService=e,this.DayLeftService=f;var g=this;a.get("/userid").success(function(a){d(function(){a=a.substr(1,a.length-2),b.user=a})}).error(function(){}),b.user={},a.get("/todos").success(function(a){d(function(){b.todos=a,g.DayLeftService.convertDay(b.todos)})}).error(function(){}),b.todos=[],b.form={},b.addToDo=function(){a.post("/todos",b.form).success(function(a){d(function(){b.todos.push(a),g.DayLeftService.convertDay(b.todos),b.form={}})})},b.archiveToDo=function(b){a.put("/todos",b).success(function(){b.status="archive"}).error(function(a){console.log("error> ",a)})},b.logout=function(){e.logout().then(function(){c.url("/")},function(){c.url("/")})}}]);